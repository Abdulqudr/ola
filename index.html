<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Four in a Row</title>
  <link rel="stylesheet" href="style.css">

  <!-- Mini App Discovery -->
  <meta property="fc:miniapp" content="https://ola-azure.vercel.app/.well-known/farcaster.json">

  <!-- PERFECT EMBED CARD -->
  <meta name="fc:miniapp" content='{
    "version": "next",
    "imageUrl": "https://ola-azure.vercel.app/hero.png",
    "button": {
      "title": "Play Connect Four",
      "action": {
        "type": "launch_miniapp",
        "name": "Four in a Row",
        "url": "https://ola-azure.vercel.app"
      }
    }
  }' />

  <!-- Fallback Open Graph -->
  <meta property="og:title" content="Four in a Row">
  <meta property="og:description" content="Beat the AI Â· streaks Â· achievements Â· multiplayer">
  <meta property="og:image" content="https://ola-azure.vercel.app/hero.png">
</head>
<body>
  <!-- Dashboard Screen -->
  <div id="dashboardScreen" class="screen active">
    <div class="dashboard">
      <div class="dashboard-header">
        <h1 class="dashboard-title">CONNECT 4</h1>
        <p class="dashboard-subtitle">Think. Block. Connect. Win.</p>
      </div>
      
      <div class="dashboard-menu">
        <button id="newGameBtn" class="dashboard-btn primary">
          <span class="btn-icon">ğŸ®</span>
          New Game
        </button>
        <button id="multiplayerBtn" class="dashboard-btn">
          <span class="btn-icon">ğŸ‘¥</span>
          Multiplayer
        </button>
        <button id="leaderboardBtn" class="dashboard-btn">
          <span class="btn-icon">ğŸ†</span>
          Leaderboard
        </button>
        <button id="dashboardSettingsBtn" class="dashboard-btn">
          <span class="btn-icon">âš™ï¸</span>
          Settings
        </button>
      </div>

      <!-- Authentication Section -->
      <div class="auth-section" style="margin-top: 30px; text-align: center; width: 100%; max-width: 320px;">
        <div id="authStatus" class="auth-status hidden" style="background: var(--card-bg); padding: 16px; border-radius: 12px; border: 2px solid rgba(126, 224, 255, 0.3); margin-bottom: 12px;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px;">
            <div id="userAvatar" class="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #3fd6ff); display: flex; align-items: center; justify-content: center; font-weight: bold; color: #042233; font-size: 16px;"></div>
            <div style="text-align: left;">
              <div id="userInfo" style="font-size: 14px; font-weight: 600; color: var(--text);"></div>
              <div style="font-size: 12px; color: var(--muted);">Signed in with Farcaster</div>
            </div>
          </div>
          <button id="signOutBtn" class="btn" style="font-size: 12px; padding: 6px 12px;">Sign Out</button>
        </div>
        
        <button id="signInBtn" class="dashboard-btn" style="margin-top: 0;">
          <span class="btn-icon">ğŸ”</span>
          Sign In with Farcaster
        </button>
      </div>
      
      <div class="dashboard-footer">
        <div class="current-streak" id="dashboardStreak">
          Current Streak: <span id="streakCount">0</span> ğŸ”¥
        </div>
      </div>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="screen hidden">
    <div class="app">
      <header class="topbar">
        <div class="player-info">
          <div class="player-avatar">
            <img src="assets/avatars/male-avatar.png" alt="You" class="avatar-image">
            <div class="avatar-fallback">â™‚</div>
          </div>
          <div class="player-name">You</div>
          <div class="win-counter">Wins: <span id="playerWins" class="win-count">0</span></div>
          <div class="player-disk-indicator player-color"></div>
        </div>
        
        <div class="game-status">
          <div class="status-text" id="statusText">YOUR TURN</div>
          <div class="game-mode-indicator" id="gameModeIndicator">vs AI</div>
        </div>
        
        <div class="player-info opponent">
          <div class="player-avatar">
            <img src="assets/avatars/ai-avatar.png" alt="Computer" class="avatar-image">
            <div class="avatar-fallback">AI</div>
          </div>
          <div class="player-name" id="opponentName">Computer</div>
          <div class="win-counter">Wins: <span id="aiWins" class="win-count">0</span></div>
          <div class="player-disk-indicator ai-color"></div>
        </div>
      </header>

      <main class="game-area">
        <div class="board-wrap">
          <div id="aiPulse" class="ai-pulse hidden" aria-hidden="true"></div>
          <div id="board" class="board" aria-label="Connect Four board"></div>
        </div>
      </main>

      <div class="bottom-controls">
        <button id="helpBtn" class="icon-btn help-icon" aria-label="How to Play">
          <span>?</span>
        </button>
        
        <button id="backToDashboardBtn" class="back-btn">BACK</button>
        
        <button id="statsBtn" class="icon-btn" aria-label="Statistics">
          ğŸ“Š
        </button>
      </div>

      <div id="overlay" class="overlay hidden" aria-hidden="true">
        <div class="overlay-card">
          <div id="overlayMessage" class="overlay-message"></div>
          <div class="overlay-actions">
            <button id="overlayNew" class="btn primary">Play Again</button>
            <button id="overlayDashboard" class="btn">Dashboard</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <h2>Settings</h2>
      
      <div class="modal-section">
        <label>Difficulty:
          <select id="difficulty">
            <option value="easy" selected>Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </label>
      </div>

      <div class="modal-section">
        <label>Your Avatar:
          <select id="avatarSelect">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </label>
      </div>
      
      <div class="modal-section">
        <label>Theme:
          <select id="themeSelect">
            <option value="neon">Neon</option>
            <option value="white">White</option>
          </select>
        </label>
      </div>
      
      <div class="modal-section">
        <label class="toggle-label">
          <span>Sound</span>
          <div class="toggle-container">
            <input type="checkbox" id="soundToggle" checked />
            <span class="toggle-slider">
              <span class="toggle-text-on">ON</span>
              <span class="toggle-text-off">OFF</span>
            </span>
          </div>
        </label>
      </div>
      
      <div class="modal-actions">
        <button id="closeSettingsBtn" class="btn primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div id="helpModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <h2>How to Play</h2>
      <div class="help-content">
        <p><strong>Objective:</strong> Be the first to connect four of your discs in a row horizontally, vertically, or diagonally.</p>
        
        <p><strong>Game Modes:</strong></p>
        <ul>
          <li>ğŸ® <strong>Single Player:</strong> Play against AI with 3 difficulty levels</li>
          <li>ğŸ‘¥ <strong>Multiplayer:</strong> Play against a friend on the same device</li>
        </ul>
        
        <p><strong>Gameplay:</strong></p>
        <ul>
          <li>Tap on any column to drop your disc</li>
          <li>Discs fall to the lowest available space in the column</li>
          <li>Take turns with your opponent</li>
          <li>First to get four in a row wins!</li>
        </ul>
        
        <p><strong>Features:</strong></p>
        <ul>
          <li>ğŸ”¥ Win streaks for consecutive wins</li>
          <li>ğŸ† 22+ achievements across 4 difficulty tiers</li>
          <li>ğŸ“Š Track your statistics and progress</li>
          <li>ğŸ¨ Multiple themes and avatars</li>
          <li>ğŸ‘¥ Single Player & Multiplayer modes</li>
          <li>ğŸ” Farcaster authentication</li>
        </ul>
      </div>
      <div class="modal-actions">
        <button id="closeHelpBtn" class="btn primary">Got It</button>
      </div>
    </div>
  </div>

  <!-- Stats Modal -->
  <div id="statsModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <h2>Game Statistics</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="statTotalGames">0</div>
          <div class="stat-label">Total Games</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statWinRate">0%</div>
          <div class="stat-label">Win Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statCurrentStreak">0</div>
          <div class="stat-label">Current Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statBestStreak">0</div>
          <div class="stat-label">Best Streak</div>
        </div>
      </div>
      
      <h3 style="margin-top: 24px;">Achievements</h3>
      <div class="achievement-list" id="achievementList">
        <!-- Achievements will be populated by JavaScript -->
      </div>
      
      <div class="modal-actions">
        <button id="closeStatsBtn" class="btn primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Leaderboard Modal -->
  <div id="leaderboardModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <h2>Leaderboard</h2>
      <div class="leaderboard-content">
        <div class="leaderboard-tabs">
          <button class="leaderboard-tab active" data-tab="single">Single Player</button>
          <button class="leaderboard-tab" data-tab="multiplayer">Multiplayer</button>
          <button class="leaderboard-tab" data-tab="farcaster">Farcaster</button>
        </div>
        
        <div id="singleLeaderboard" class="leaderboard-list active">
          <!-- Single player leaderboard will be populated by JavaScript -->
        </div>
        
        <div id="multiplayerLeaderboard" class="leaderboard-list">
          <!-- Multiplayer leaderboard will be populated by JavaScript -->
        </div>

        <div id="farcasterLeaderboard" class="leaderboard-list">
          <!-- Farcaster leaderboard will be populated by JavaScript -->
        </div>
      </div>
      <div class="modal-actions">
        <button id="closeLeaderboardBtn" class="btn primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Audio -->
  <audio id="sfxPlace" src="sounds/drop.mp3" preload="auto"></audio>
  <audio id="sfxWin" src="sounds/win.mp3" preload="auto"></audio>

  <!-- Your game logic -->
  <script src="app.js"></script>

  <!-- Farcaster Mini App SDK -->
  <script type="module">
    import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';

    // Make SDK available globally
    window.sdk = sdk;

    // Fresh start for new players
    if (!localStorage.getItem('connect4_visited')) {
      localStorage.clear();
      localStorage.setItem('connect4_visited', 'true');
    }

    // Initialize when SDK is ready
    window.addEventListener('load', async () => {
      try {
        await sdk.actions.ready();
        console.log('Mini App ready â€” splash dismissed!');
        
        // Initialize game after SDK is ready
        if (window.initGame) {
          window.initGame();
        }
      } catch (e) {
        console.log('Not in Mini App (desktop mode)');
        // Still initialize game in desktop mode
        if (window.initGame) {
          window.initGame();
        }
      }
    });
  </script>
</body>
</html>
