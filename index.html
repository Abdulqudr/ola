<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Four in a Row</title>
  <link rel="stylesheet" href="style.css">

  <!-- Base / Farcaster Mini App tags -->
  <meta property="fc:miniapp" content="https://ola-azure.vercel.app/.well-known/farcaster.json">
  <meta property="og:title" content="Four in a Row">
  <meta property="og:description" content="Beat the AI · streaks · achievements · multiplayer">
  <meta property="og:image" content="https://ola-azure.vercel.app/hero.png">
</head>
<body>
  <div class="app">
    <!-- ALL YOUR ORIGINAL HTML (header, board, modals, etc.) — unchanged -->
    <!-- (I’m keeping it short here, but everything you had before is still there) -->

    <header class="topbar">…</header>
    <main class="game-area">…</main>
    <div class="bottom-controls">…</div>

    <!-- All your modals: overlay, settings, help, stats, multiplayer -->
    <!-- (exactly the same as your working version) -->
    <div id="overlay" class="overlay hidden">…</div>
    <div id="settingsModal" class="modal hidden">…</div>
    <div id="helpModal" class="modal hidden">…</div>
    <div id="statsModal" class="modal hidden">…</div>
    <div id="multiplayerModal" class="modal hidden">…</div>
  </div>

  <!-- Audio -->
  <audio id="sfxPlace" src="sounds/drop.mp3" preload="auto"></audio>
  <audio id="sfxWin" src="sounds/win.mp3" preload="auto"></audio>

  <!-- 1. Load the Mini App SDK first -->
  <script src="https://cdn.jsdelivr.net/npm/@farcaster/miniapp-sdk@0.2.3/dist/sdk.js"></script>

  <!-- 2. Your original game script (unchanged — everything works) -->
  <script src="app.js"></script>

  <!-- 3. Clean, reliable ready() signal + fresh start for new players -->
  <script>
    // Fresh start: only run once per user (first visit ever)
    if (!localStorage.getItem('connect4_visited')) {
      localStorage.clear();                    // wipes any old junk
      localStorage.setItem('connect4_visited', 'true');
    }

    // Tell Base/Warpcast we’re ready → no browser redirect
    function sendReady() {
      if (window.MiniAppSdk?.actions?.ready) {
        window.MiniAppSdk.actions.ready();
      }
    }

    // Fire early and on load
    document.addEventListener('DOMContentLoaded', sendReady);
    window.addEventListener('load', sendReady);
  </script>
</body>
</html>
